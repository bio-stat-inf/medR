<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Apply</title>

<script src="site_libs/header-attrs-2.18/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Медицинский R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Главная</a>
</li>
<li>
  <a href="Journal.html">Содержание</a>
</li>
<li>
  <a href="Links.html">Ссылки</a>
</li>
<li>
  <a href="intro_r.html">Введение в R</a>
</li>
<li>
  <a href="typerdata.html">Типы данных</a>
</li>
<li>
  <a href="typerdataM.html">Типы данных (доп.)</a>
</li>
<li>
  <a href="apply_f.html">Векторизация)</a>
</li>
<li>
  <a href="learnr_page/learnr_page.html">Задания</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Apply</h1>

</div>


<pre class="r"><code>library(dplyr)
require(ggplot2)</code></pre>
<div id="векторизированные-вычисления" class="section level1">
<h1>Векторизированные вычисления</h1>
<div id="векторизованные-вычисления-в-r-с-использованием-apply-функций"
class="section level2">
<h2>Векторизованные вычисления в R с использованием apply-функций</h2>
<p>Использование оператора циклов <code>for()</code>, что характерно для
языков низкого уровня типа Basic, не считается хорошим стилем
программирования на языке R, ориентированном на векторизацию вычислений.
Вместо того, чтобы выполнять последовательно скалярные операции над
каждым из элементов массива, гораздо эффективнее выполнять параллельные
вычисления, при которых программа обрабатывает одновременно весь массив
(вектор) целиком или по несколько элементов вектора в каждый момент
времени. Очевидно, что такой подход потенциально может привести к
значительному ускорению однотипных вычислений над большими массивами
данных. Рассмотрим простейший пример векторизованных вычислений в R.
Допустим, у нас имеется вектор из 10 положительных чисел, и мы хотим
извлечь квадратный корень из каждого из них. Вместо написания цикла для
поочередного выполнения этой операции над каждым элементом, мы просто
подаем весь этот вектор на вход функции sqrt(), которая возвращает
вектор с результатами вычислений:</p>
<pre class="r"><code>x &lt;- 1:10
sqrt(x)</code></pre>
<pre><code>##  [1] 1.000000 1.414214 1.732051 2.000000 2.236068 2.449490 2.645751 2.828427
##  [9] 3.000000 3.162278</code></pre>
<p>Принцип векторизованных вычислений применим не только к векторам как
таковым, но и к более сложным объектам R - матрицам, спискам и таблицам
данных (для R разницы между последними двумя типами объектов не
существует: фактически таблица данных является списком из нескольких
компонентов - векторов одинакового размера).</p>
<p>В базовой комплектации R имеется целое семейство функций,
предназначенных для организации векторизованных вычислений над такими
объектами.</p>
<p>В названии всех этих функций имеется слово <strong>apply</strong>
(англ. применить), которому предшествует буква, указывающая на принцип
работы той или иной функции (см. подробнее в справочном файле
<code>?apply</code>). При этом: - <code>apply()</code> в отличии от
<code>for()</code> можно легко распараллелить (просто переименовав
функцию в ее параллельную версию из пакета snow); - алгоритмы,
записанные без циклов, легче модифицируются, содержат меньше ошибок и
легче набираются в командной строке; - результат работы
<code>apply()</code> может быть аргументом функции, не говоря уже о том
что любая функция может быть вставлена в качестве аргумента в
<code>apply()</code> . В ответе на один из вопросов, опубликованных на
сайте stackoverflow.com, который мы постоянно используем для поиска
информации по R, был дан замечательный обзор apply-функций с примерами
их использования. Ниже приводится перевод этого сообщения (с некоторыми
изменениями и дополнениями).</p>
</div>
</div>
<div id="функция-apply" class="section level1">
<h1>Функция apply()</h1>
<p>Функция <code>apply()</code> - используется в случаях, когда
необходимо применить какую- либо функцию ко всем строкам или столбцам
матрицы (или массивам большей размерности):</p>
<blockquote>
<p><code>apply(x, MARGIN, FUN, ...)</code></p>
</blockquote>
<p>где x - это преобразуемый объект,<br />
MARGIN - индекс, обозначающий направление процесса вычислений (по
столбцам или строкам),<br />
FUN - применяемая для вычислений функция, а<br />
… - это любые другие параметры применяемой функции.</p>
<p>Для матрицы или таблицы данных MARGIN = 1 обозначает строки, а MARGIN
= 2 - столбцы. Поскольку FUN означает любую функцию R, в том числе и ту,
которую вы сами написали (см. раздел 2.7), то функция
<code>apply()</code> - это мощное средство модульной обработки
данных.</p>
<pre class="r"><code># Создадим обычную двумерную матрицу:
M &lt;- matrix(seq(1,16), 4, 4)
# Найдем минимальные значения в каждой строке матрицы 
apply(M, 1, min)</code></pre>
<pre><code>## [1] 1 2 3 4</code></pre>
<pre class="r"><code>#[1] 1 2 3 4
# Найдем минимальные значения в каждом столбце матрицы 
apply(M, 2, max)</code></pre>
<pre><code>## [1]  4  8 12 16</code></pre>
<pre class="r"><code>#[1] 4 8 12 16
# Пример с трехмерным массивом:
M &lt;- array(seq(32), dim = c(4,4,2))
# Применим функцию sum() к кадому элементу M[*, ,],
# т.е. выполним суммирование по измерениями 2 и 3: 
apply(M, 1, sum)</code></pre>
<pre><code>## [1] 120 128 136 144</code></pre>
<pre class="r"><code># Результат - одномерный вектор:
#[1] 120 128 136 144
# Применим функцию SUW()K каждому элементу M[*, *, ],
# - т.е. выполним суммирование по третьему измерению: 
apply(M, c(1,2), sum)</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]   18   26   34   42
## [2,]   20   28   36   44
## [3,]   22   30   38   46
## [4,]   24   32   40   48</code></pre>
<pre class="r"><code># Результат - матрица:</code></pre>
<p>При необходимости вычисления сумм и средних значений по строкам или
столбцам матриц рекомендуется также использовать очень быстрые и
специально оптимизированные для этого функции <code>colSums()</code>,
<code>rowSums()</code>, <code>colMeans()</code> и
<code>rowMeans()</code>.</p>
</div>
<div id="функция-lapply" class="section level1">
<h1>Функция lapply()</h1>
<p>Функция <code>lapply()</code> - используется в случаях, когда
необходимо применить какую-либо функцию к каждому компоненту списка и
получить результат также в виде списка (буква “l” в названии
<code>lapply()</code> означает list - “список”).</p>
<pre class="r"><code># Создадим список с тремя компонентами-векторами:
x &lt;- list(a = 1, b = 1:3, c = 10:100)
# Выясним размер каждого компонента списка х
# (функция length()):
lapply(x, FUN = length)</code></pre>
<pre><code>## $a
## [1] 1
## 
## $b
## [1] 3
## 
## $c
## [1] 91</code></pre>
<pre class="r"><code># Выполним суммирование элементов в каждом компоненте списка х:
lapply(x, FUN = sum)</code></pre>
<pre><code>## $a
## [1] 1
## 
## $b
## [1] 6
## 
## $c
## [1] 5005</code></pre>
</div>
<div id="функция-sapply" class="section level1">
<h1>Функция sapply()</h1>
<p>Функция <code>sapply()</code> - используется в случаях, когда
необходимо применить какую-либо функцию к каждому компоненту списка, но
результат вывести в виде вектора (буква “s” в названии
<code>sapply()</code> означает simplify - “упростить”).</p>
<pre class="r"><code># Список из трех компонентов:
x &lt;- list(a = 1, b = 1:3, c = 10:100)
# Выясним размер каждого компонента списка х:
sapply(x, FUN = length)</code></pre>
<pre><code>##  a  b  c 
##  1  3 91</code></pre>
<pre class="r"><code>#a b c
#1 3 91 # результат возвращен в виде вектора</code></pre>
<pre class="x"><code>x &lt;- list(a = 1, b = 1:3, c = 10:100)
# Суммирование всех элементов в каждом компоненте списка х:
sapply(x, FUN = sum)
#a b c
#1 6 5005 # результат возвращен в виде вектора</code></pre>
<p>В некоторых более “продвинутых” случаях <code>sapply()</code> может
выдать результат в виде многомерного массива. Например, если применяемая
нами функция возвращает векторы одинаковой длины, <code>sapply()</code>
объединит эти векторы в матрицу (по столбцам):</p>
<pre class="r"><code>sapply(1:5,function(x) rnorm(3,x))</code></pre>
<pre><code>##           [,1]     [,2]     [,3]     [,4]     [,5]
## [1,] 0.7351589 1.518388 3.658354 5.263305 5.565314
## [2,] 1.2791661 3.218213 3.618927 5.516193 4.718326
## [3,] 0.8281737 1.441695 3.040396 3.234470 4.507602</code></pre>
<p>Если применяемая функция возвращает матрицу, то <code>sapply()</code>
преобразует каждую матрицу в вектор и объединит такие векторы в одну
большую матрицу (звучит не очень понятно, но пример хорошо поясняет эту
идею):</p>
<pre class="r"><code>sapply(1:5,function(x) matrix(x, 2, 2))</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    2    3    4    5
## [2,]    1    2    3    4    5
## [3,]    1    2    3    4    5
## [4,]    1    2    3    4    5</code></pre>
<p>Поведение <code>sapply()</code>, продемонстрированное в последнем
примере, можно отменить при помощи аргумента simplify = “array” - в этом
случае матрицы будут объединены в один многомерный массив:</p>
<pre class="r"><code>sapply(1:5,function(x) matrix(x,2,2), simplify = &quot;array&quot;)</code></pre>
<pre><code>## , , 1
## 
##      [,1] [,2]
## [1,]    1    1
## [2,]    1    1
## 
## , , 2
## 
##      [,1] [,2]
## [1,]    2    2
## [2,]    2    2
## 
## , , 3
## 
##      [,1] [,2]
## [1,]    3    3
## [2,]    3    3
## 
## , , 4
## 
##      [,1] [,2]
## [1,]    4    4
## [2,]    4    4
## 
## , , 5
## 
##      [,1] [,2]
## [1,]    5    5
## [2,]    5    5</code></pre>
</div>
<div id="функция-replicate" class="section level1">
<h1>Функция replicate()</h1>
<p>Функция <code>replicate()</code> является своего рода “оберткой” для
функции <code>sapply(</code>) и позволяет провести серию вычислений с
целью генерации набора чисел по заданному алгоритму. Синтаксис функции
имеет вид:</p>
<blockquote>
<p><code>replicate(n, expr, simplify=TRUE)</code></p>
</blockquote>
<p>где <code>n</code> - число повторов, <code>expr</code> - функция или
группа выражений, которые надо повторить <code>n</code> раз,
<code>simplify = TRUE</code> - необязательный параметр, который пробует
упростить результат и представить его в виде вектора или матрицы
значений. Рассмотрим пример использования функции
<code>replicate()</code> для проверки статистической гипотезы о
равенстве медиан двух выборок бутстреп-методом (см. раздел 2.7).
Созданная нами функция <code>boot_med()</code> из каждой исходной
выборки x и у извлекает по N псевдовыборок, используя алгоритм
“случайного выбора с возвратом”, и находит разность их медиан. Здесь
функция <code>sample.int()</code> формирует целочисленные наборы
случайных индексов <code>indx</code> и <code>indy</code> для каждого из
сравниваемых векторов:</p>
<pre class="r"><code>boot_med &lt;- function(x, y, N=100) {
 replicate(N, {
   indx &lt;- sample.int(length(x), length(x), replace=T) 
   indy &lt;- sample.int(length(y), length(y), replace=T) 
   median(x[indx]) - median(y[indy])
 })
}</code></pre>
<p>Для тестирования функции проверим однородность медиан для двух
случайных выборок из нормального распределения со средним mean=10 и
стандартным отклонением sd=4:</p>
<pre class="r"><code>Y &lt;- rnorm(100, sd=4, mean=10)
X &lt;- rnorm(100, sd=4, mean=10)
quantile(boot_med(Y,X,10000), probs = c(0.025, 0.975))</code></pre>
<pre><code>##       2.5%      97.5% 
## -2.4989261  0.5825823</code></pre>
<p>Поскольку доверительный интервал разности медиан включает 0, то
нулевую гипотезу отклонять не следует.</p>
</div>
<div id="функция-vapply" class="section level1">
<h1>Функция vapply()</h1>
<p>Функция <code>vapply()</code> - схожа с <code>sapply()</code>, но
работает несколько быстрее за счет того, что пользователь однозначно
указывает тип возвращаемых значений (буква “v” в названии
<code>vapply()</code> означает velocity - “скорость”; пример сравнения
<code>sapply()</code> и <code>vapply()</code> можно найти на
stackoverflow.com).</p>
<p>Такой подход позволяет также избегать сообщений об ошибках (и
прерывания вычислений), возникающих при работе с <code>sapply()</code> в
некоторых ситуациях. При вызове vapply() пользователь должен привести
пример ожидаемого типа возвращаемых значений. Для этого служит аргумент
<code>FUN.VALUE</code>:</p>
<pre class="r"><code># Аргументу FUN.VALUE присвоено логическое значение FALSE.
# Этим задается тип возвращаемых функцией значений,
# который ожидает пользователь
a &lt;- vapply(NULL, is.factor, FUN.VALUE = FALSE)
# Функция sapply() применена к тому же NULL-объекту:
b &lt;- sapply(NULL, is.factor)
# Проверка типа переменных:
is.logical(a)</code></pre>
<pre><code>## [1] TRUE</code></pre>
<pre class="r"><code>#[1] TRUE
is.logical(b)</code></pre>
<pre><code>## [1] FALSE</code></pre>
<pre class="r"><code>#[1] FALSE</code></pre>
</div>
<div id="функция-mapply" class="section level1">
<h1>Функция mapply()</h1>
<p>Функция <code>mapply()</code> - используется в случаях, когда
необходимо поэлементно применить какую-либо функцию одновременно к
нескольким объектам (например, получить сумму первых элементов векторов,
затем сумму вторых элементов векторов, и т.д.). Результат возвращается в
виде вектора или массива другой размерности (см. примеры для
<code>sapply()</code> выше). Буква “m” в названии <code>mapply()</code>
означает multivariate - “многомерный” (имеется в виду одновременное
выполнение вычислений над элементами нескольких объектов).</p>
<pre class="r"><code>mapply(sum, 1:5, 1:5, 1:5)</code></pre>
<pre><code>## [1]  3  6  9 12 15</code></pre>
<pre class="r"><code>#[1] 3 6 9 12 15</code></pre>
</div>
<div id="функция-rapply" class="section level1">
<h1>Функция rapply()</h1>
<p>Функция <code>rapply()</code> - используется в случаях, когда
необходимо применить какую-либо функцию к компонентам вложенного списка
(буква “r” в названии <code>rapply()</code> означает recursively -
“рекурсивно”).</p>
<pre class="r"><code># Пользовательская функция, которая добавляет ! к элементу
# объекта x если этот элемент является текстовым выражением
# или добавляет 1 если этот элемент является числом: 
myFun &lt;- function (x){
   if (is.character(x)){
   return(paste(x,&quot;!&quot;,sep=&quot;&quot;))
   }
   else {
   return(x + 1)
   }
}</code></pre>
<pre class="r"><code># Пример вложенного списка:
l &lt;- list(a = list(a1 = &quot;Boo&quot;, b1 = 2, c1 = &quot;Eeek&quot;),
          b = 3, c = &quot;Yikes&quot;,
          d = list(a2 = 1, b2 = list(a3 = &quot;Hey&quot;, b3 = 5)))
l </code></pre>
<pre><code>## $a
## $a$a1
## [1] &quot;Boo&quot;
## 
## $a$b1
## [1] 2
## 
## $a$c1
## [1] &quot;Eeek&quot;
## 
## 
## $b
## [1] 3
## 
## $c
## [1] &quot;Yikes&quot;
## 
## $d
## $d$a2
## [1] 1
## 
## $d$b2
## $d$b2$a3
## [1] &quot;Hey&quot;
## 
## $d$b2$b3
## [1] 5</code></pre>
<pre class="r"><code># Рекурсивное применение функции myFun к списку l:
rapply(l,myFun)</code></pre>
<pre><code>##     a.a1     a.b1     a.c1        b        c     d.a2  d.b2.a3  d.b2.b3 
##   &quot;Boo!&quot;      &quot;3&quot;  &quot;Eeek!&quot;      &quot;4&quot; &quot;Yikes!&quot;      &quot;2&quot;   &quot;Hey!&quot;      &quot;6&quot;</code></pre>
<p>Если необходимо вернуть результат в виде вложенного списка, можно
воспользоваться аргументом <code>how = "replace"</code>. В этом случае
исходные значения в списке <code>l</code> будут заменены на новые:</p>
<pre class="r"><code>rapply(l, myFun, how = &quot;replace&quot;)</code></pre>
<pre><code>## $a
## $a$a1
## [1] &quot;Boo!&quot;
## 
## $a$b1
## [1] 3
## 
## $a$c1
## [1] &quot;Eeek!&quot;
## 
## 
## $b
## [1] 4
## 
## $c
## [1] &quot;Yikes!&quot;
## 
## $d
## $d$a2
## [1] 2
## 
## $d$b2
## $d$b2$a3
## [1] &quot;Hey!&quot;
## 
## $d$b2$b3
## [1] 6</code></pre>
</div>
<div id="функция-tapply" class="section level1">
<h1>Функция tapply()</h1>
<p>Функция <code>tapply()</code> - используется в случаях, когда
необходимо применить какую-либо функцию fun к отдельным группам
элементов вектора x, заданным в соответствии с уровнями какого-либо
фактора group:</p>
<blockquote>
<p>‘tapply(x, group, fun, …)’</p>
</blockquote>
<p>Например, в следующем фрагменте кода функция sample() используется
для создания двух случайных выборок: из 50 значений целых чисел от 1 до
4 и связанных с ними меток четырех групп A-D. Функция tapply()
подсчитывает суммы х для каждого из значений фактора:</p>
<pre class="r"><code>x &lt;- sample(1:4, size=50, replace=T)
gr &lt;- as.factor(sample(c(&quot;A&quot;,&quot;B&quot;,&quot;C&quot;,&quot;D&quot;), size=50, replace=T))
tapply(x, gr,sum)</code></pre>
<pre><code>##  A  B  C  D 
## 20 24 30 40</code></pre>
<p>Другие примеры использования <code>tapply()</code> мы приведем
позднее в разделе, посвященном расчету параметров описательной
статистики.</p>
<div id="функция-by" class="section level2">
<h2>Функция by()</h2>
<p>Функция <code>by()</code> является своего рода аналогом функции
<code>tapply()</code>, с той разницей, что она применяется для таблиц.
Таблица <code>data</code> разделяется в соответствии с заданным
столбцом-фактором group на подмножество подтаблиц и для обработки каждой
такой части определяется функция <code>fun</code>:</p>
<blockquote>
<p><code>by(data, group, fun, ...)</code></p>
</blockquote>
<p>Рассмотрим пример с таблицей Моллюски, представленной в разделе 1.3,
и рассчитаем средние значения длины раковины <code>ZMlength</code> и
численности инфузорий <code>CAnumber</code> для каждого из трех
обследованных озер <code>Lake</code> (Баторино, Мястро и Нарочь):</p>
<pre class="r"><code>#Моллюски &lt;-
#read.table(&quot;http://figshare.com/media/download/98923/97987&quot;,
#header=TRUE, sep=&quot;\t&quot;, na.strings=&quot;NA&quot;, strip.white=TRUE)
#by(Моллюски[,4:5], Моллюски$Lake, colMeans)</code></pre>
</div>
</div>
<div id="функция-outer" class="section level1">
<h1>Функция outer()</h1>
<p>Функция <code>outer(</code>) позволяет выполнить комбинаторную
операцию fun над элементами двух массивов или векторов x и у, не
прибегая к явному использованию “двойного” цикла:</p>
<blockquote>
<p><code>outer(x, у, fun="*", ...)</code></p>
</blockquote>
<p>По умолчанию осуществляется операция попарного перемножения</p>
<pre class="r"><code>х &lt;- 1:5; у &lt;-1:5
outer(х,у)</code></pre>
<pre><code>##      [,1] [,2] [,3] [,4] [,5]
## [1,]    1    2    3    4    5
## [2,]    2    4    6    8   10
## [3,]    3    6    9   12   15
## [4,]    4    8   12   16   20
## [5,]    5   10   15   20   25</code></pre>
<p>Используя, например, функцию <code>outer()</code> вместе с функцией
<code>paste()</code>, можно сгенерировать все возможные попарные
комбинации “связок” элементов символьного и целочисленного векторов:</p>
<pre class="r"><code>х &lt;- c(&quot;А&quot;, &quot;В&quot;, &quot;С&quot;, &quot;D&quot;)
у &lt;- 1:10
outer(x, у, paste, sep=&quot;&quot;)</code></pre>
<pre><code>##       [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8] [,9] [,10]
##  [1,] &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;110&quot;
##  [2,] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;310&quot;
##  [3,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
##  [4,] &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;110&quot;
##  [5,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
##  [6,] &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;110&quot;
##  [7,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
##  [8,] &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;110&quot;
##  [9,] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;310&quot;
## [10,] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;310&quot;
## [11,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
## [12,] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;310&quot;
## [13,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
## [14,] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;310&quot;
## [15,] &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;110&quot;
## [16,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
## [17,] &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;110&quot;
## [18,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
## [19,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
## [20,] &quot;41&quot; &quot;42&quot; &quot;43&quot; &quot;44&quot; &quot;45&quot; &quot;46&quot; &quot;47&quot; &quot;48&quot; &quot;49&quot; &quot;410&quot;
## [21,] &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;110&quot;
## [22,] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;310&quot;
## [23,] &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;110&quot;
## [24,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
## [25,] &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;110&quot;
## [26,] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;310&quot;
## [27,] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;310&quot;
## [28,] &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;110&quot;
## [29,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
## [30,] &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;110&quot;
## [31,] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;310&quot;
## [32,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
## [33,] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;310&quot;
## [34,] &quot;41&quot; &quot;42&quot; &quot;43&quot; &quot;44&quot; &quot;45&quot; &quot;46&quot; &quot;47&quot; &quot;48&quot; &quot;49&quot; &quot;410&quot;
## [35,] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;310&quot;
## [36,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
## [37,] &quot;41&quot; &quot;42&quot; &quot;43&quot; &quot;44&quot; &quot;45&quot; &quot;46&quot; &quot;47&quot; &quot;48&quot; &quot;49&quot; &quot;410&quot;
## [38,] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;310&quot;
## [39,] &quot;41&quot; &quot;42&quot; &quot;43&quot; &quot;44&quot; &quot;45&quot; &quot;46&quot; &quot;47&quot; &quot;48&quot; &quot;49&quot; &quot;410&quot;
## [40,] &quot;41&quot; &quot;42&quot; &quot;43&quot; &quot;44&quot; &quot;45&quot; &quot;46&quot; &quot;47&quot; &quot;48&quot; &quot;49&quot; &quot;410&quot;
## [41,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
## [42,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
## [43,] &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;110&quot;
## [44,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
## [45,] &quot;41&quot; &quot;42&quot; &quot;43&quot; &quot;44&quot; &quot;45&quot; &quot;46&quot; &quot;47&quot; &quot;48&quot; &quot;49&quot; &quot;410&quot;
## [46,] &quot;11&quot; &quot;12&quot; &quot;13&quot; &quot;14&quot; &quot;15&quot; &quot;16&quot; &quot;17&quot; &quot;18&quot; &quot;19&quot; &quot;110&quot;
## [47,] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;310&quot;
## [48,] &quot;21&quot; &quot;22&quot; &quot;23&quot; &quot;24&quot; &quot;25&quot; &quot;26&quot; &quot;27&quot; &quot;28&quot; &quot;29&quot; &quot;210&quot;
## [49,] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;310&quot;
## [50,] &quot;31&quot; &quot;32&quot; &quot;33&quot; &quot;34&quot; &quot;35&quot; &quot;36&quot; &quot;37&quot; &quot;38&quot; &quot;39&quot; &quot;310&quot;</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
